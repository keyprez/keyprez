import{S as pe,i as fe,s as de,k as w,w as H,a as G,q as N,l as E,m as C,x as Q,c as U,r as q,h,n as S,b as A,y as Z,F as d,G as W,u as z,f as $,t as x,z as ee,Y as ne,L as J,ad as he,X as _e,B as ie,W as te,D as ce,J as me,ae as re}from"../../../chunks/index-f8865573.js";import{S as be}from"../../../chunks/SvelteSeo-233e266b.js";import{c as ge}from"../../../chunks/create-form-f4fa6aab.js";import{c as ke,a as K}from"../../../chunks/Loader-3cb8697c.js";import{p as ye}from"../../../chunks/lodash-9e5aa114.js";import{c as ve}from"../../../chunks/store-e69f09a2.js";import{B as Se}from"../../../chunks/Button-b60b5419.js";import{f as X}from"../../../chunks/fetchData-47df6b6c.js";import{s as we}from"../../../chunks/config-f8d0f65c.js";const Ee=async t=>{const{body:e}=await X(t,"/orders/checkout"),{id:r}=e;return r},Ce=async t=>{const e=await X(t,"/orders/shipping");if(e.status!==200)return{shippingRate:null,error:e.message};const r=JSON.parse(e.body);if(r.fieldErrors)return{shippingRate:null,error:r.fieldErrors[0].message};const{consignments:[{products:[{price:{listPrice:{priceWithoutAdditionalServices:{amountWithVAT:a}}}}]}]}=r;return{shippingRate:a,error:null}},Oe=async t=>{const{body:e}=await X(t,"/customers");return e},Re=async t=>{try{return await Stripe(we).redirectToCheckout({sessionId:t})}catch(e){console.error(`Error redirecting to Stripe checkout: ${e}`)}};function le(t,e,r){const a=t.slice();return a[27]=e[r],a[28]=e,a[29]=r,a}function ae(t,e,r){const a=t.slice();return a[30]=e[r],a}function Pe(t){let e,r,a,l;function s(){t[22].call(e,t[27])}return{c(){e=w("input"),this.h()},l(p){e=E(p,"INPUT",{name:!0,class:!0,type:!0,placeholder:!0}),this.h()},h(){S(e,"name",t[27]),S(e,"class",r="py-6 px-4 border-2 rounded-lg shadow-xl text-black dark:text-white dark:bg-transparent "+(t[7][t[27]]?"border-red-500":"border-transparent dark:border-teal-800")),S(e,"type","text"),S(e,"placeholder",t[9](t[27]))},m(p,b){A(p,e,b),te(e,t[8][t[27]]),a||(l=[W(e,"input",s),W(e,"keyup",t[23]),W(e,"blur",t[15])],a=!0)},p(p,b){t=p,b[0]&128&&r!==(r="py-6 px-4 border-2 rounded-lg shadow-xl text-black dark:text-white dark:bg-transparent "+(t[7][t[27]]?"border-red-500":"border-transparent dark:border-teal-800"))&&S(e,"class",r),b[0]&6400&&e.value!==t[8][t[27]]&&te(e,t[8][t[27]])},d(p){p&&h(e),a=!1,ce(l)}}}function Ie(t){let e,r,a=t[9](t[27])+"",l,s,p,b,O=t[11],u=[];for(let o=0;o<O.length;o+=1)u[o]=se(ae(t,O,o));function f(){t[20].call(e,t[27])}return{c(){e=w("select"),r=w("option"),l=N(a);for(let o=0;o<u.length;o+=1)u[o].c();this.h()},l(o){e=E(o,"SELECT",{class:!0});var _=C(e);r=E(_,"OPTION",{});var c=C(r);l=q(c,a),c.forEach(h);for(let R=0;R<u.length;R+=1)u[R].l(_);_.forEach(h),this.h()},h(){r.__value="",r.value=r.__value,r.disabled=!0,S(e,"class",s="py-6 px-4 border-2 rounded-lg shadow-xl dark:bg-transparent "+(t[7][t[27]]?"border-red-500":"border-transparent dark:border-teal-800")+" "+(t[3]?"dark:text-white":"text-gray-400")),t[8][t[27]]===void 0&&me(f)},m(o,_){A(o,e,_),d(e,r),d(r,l);for(let c=0;c<u.length;c+=1)u[c].m(e,null);re(e,t[8][t[27]]),p||(b=[W(e,"change",f),W(e,"change",t[21])],p=!0)},p(o,_){if(t=o,_[0]&2048){O=t[11];let c;for(c=0;c<O.length;c+=1){const R=ae(t,O,c);u[c]?u[c].p(R,_):(u[c]=se(R),u[c].c(),u[c].m(e,null))}for(;c<u.length;c+=1)u[c].d(1);u.length=O.length}_[0]&136&&s!==(s="py-6 px-4 border-2 rounded-lg shadow-xl dark:bg-transparent "+(t[7][t[27]]?"border-red-500":"border-transparent dark:border-teal-800")+" "+(t[3]?"dark:text-white":"text-gray-400"))&&S(e,"class",s),_[0]&6400&&re(e,t[8][t[27]])},d(o){o&&h(e),ne(u,o),p=!1,ce(b)}}}function se(t){let e,r=t[30].label+"",a;return{c(){e=w("option"),a=N(r),this.h()},l(l){e=E(l,"OPTION",{});var s=C(e);a=q(s,r),s.forEach(h),this.h()},h(){e.__value=t[30].value,e.value=e.__value},m(l,s){A(l,e,s),d(e,a)},p:ie,d(l){l&&h(e)}}}function oe(t){let e,r,a,l=t[10](t[7][t[27]])+"",s,p;function b(f,o){return f[27]==="country"?Ie:Pe}let u=b(t)(t);return{c(){e=w("div"),u.c(),r=G(),a=w("small"),s=N(l),this.h()},l(f){e=E(f,"DIV",{class:!0});var o=C(e);u.l(o),r=U(o),a=E(o,"SMALL",{class:!0});var _=C(a);s=q(_,l),_.forEach(h),o.forEach(h),this.h()},h(){S(a,"class",p="absolute right-2 bottom-1 text-red-500 "+(t[7][t[27]]?"block":"hidden")),S(e,"class","relative flex flex-col w-full text-black")},m(f,o){A(f,e,o),u.m(e,null),d(e,r),d(e,a),d(a,s)},p(f,o){u.p(f,o),o[0]&128&&l!==(l=f[10](f[7][f[27]])+"")&&z(s,l),o[0]&128&&p!==(p="absolute right-2 bottom-1 text-red-500 "+(f[7][f[27]]?"block":"hidden"))&&S(a,"class",p)},d(f){f&&h(e),u.d()}}}function Ne(t){let e,r;return{c(){e=w("small"),r=N("Select Country & Postal Code")},l(a){e=E(a,"SMALL",{});var l=C(e);r=q(l,"Select Country & Postal Code"),l.forEach(h)},m(a,l){A(a,e,l),d(e,r)},p:ie,d(a){a&&h(e)}}}function qe(t){let e,r=`${t[4]} NOK`,a;return{c(){e=w("strong"),a=N(r)},l(l){e=E(l,"STRONG",{});var s=C(e);a=q(s,r),s.forEach(h)},m(l,s){A(l,e,s),d(e,a)},p(l,s){s[0]&16&&r!==(r=`${l[4]} NOK`)&&z(a,r)},d(l){l&&h(e)}}}function Te(t){let e,r;return{c(){e=w("small"),r=N(t[2]),this.h()},l(a){e=E(a,"SMALL",{class:!0});var l=C(e);r=q(l,t[2]),l.forEach(h),this.h()},h(){S(e,"class","border-red-500")},m(a,l){A(a,e,l),d(e,r)},p(a,l){l[0]&4&&z(r,a[2])},d(a){a&&h(e)}}}function Le(t){let e,r,a,l,s,p,b,O,u,f,o,_,c,R,M,P,F,j,V;r=new be({props:{title:"Keyprez - Checkout"}});let T=Object.keys(t[12]),m=[];for(let n=0;n<T.length;n+=1)m[n]=oe(le(t,T,n));function Y(n,k){return n[2]?Te:n[4]?qe:Ne}let L=Y(t),I=L(t);return P=new Se({props:{type:"submit",text:t[1]?"ERROR \u{1F61E}":"BUY",loading:t[0],onClick:t[18]}}),{c(){e=w("div"),H(r.$$.fragment),a=G(),l=w("form");for(let n=0;n<m.length;n+=1)m[n].c();s=G(),p=w("div"),b=w("p"),O=N("Price before shipping: "),u=w("strong"),f=N(t[6]),o=N(" NOK"),_=G(),c=w("p"),R=N(`Price total:
        `),I.c(),M=G(),H(P.$$.fragment),this.h()},l(n){e=E(n,"DIV",{class:!0});var k=C(e);Q(r.$$.fragment,k),a=U(k),l=E(k,"FORM",{class:!0});var y=C(l);for(let B=0;B<m.length;B+=1)m[B].l(y);s=U(y),p=E(y,"DIV",{class:!0});var g=C(p);b=E(g,"P",{class:!0});var D=C(b);O=q(D,"Price before shipping: "),u=E(D,"STRONG",{});var i=C(u);f=q(i,t[6]),o=q(i," NOK"),i.forEach(h),D.forEach(h),_=U(g),c=E(g,"P",{class:!0});var v=C(c);R=q(v,`Price total:
        `),I.l(v),v.forEach(h),g.forEach(h),M=U(y),Q(P.$$.fragment,y),y.forEach(h),k.forEach(h),this.h()},h(){S(b,"class","flex justify-between"),S(c,"class","flex justify-between"),S(p,"class","w-full"),S(l,"class","flex flex-col items-center w-full max-w-lg gap-4"),S(e,"class","flex flex-col gap-4 items-center")},m(n,k){A(n,e,k),Z(r,e,null),d(e,a),d(e,l);for(let y=0;y<m.length;y+=1)m[y].m(l,null);d(l,s),d(l,p),d(p,b),d(b,O),d(b,u),d(u,f),d(u,o),d(p,_),d(p,c),d(c,R),I.m(c,null),d(l,M),Z(P,l,null),t[24](l),F=!0,j||(V=W(l,"submit",t[16]),j=!0)},p(n,k){if(k[0]&171912){T=Object.keys(n[12]);let g;for(g=0;g<T.length;g+=1){const D=le(n,T,g);m[g]?m[g].p(D,k):(m[g]=oe(D),m[g].c(),m[g].m(l,s))}for(;g<m.length;g+=1)m[g].d(1);m.length=T.length}(!F||k[0]&64)&&z(f,n[6]),L===(L=Y(n))&&I?I.p(n,k):(I.d(1),I=L(n),I&&(I.c(),I.m(c,null)));const y={};k[0]&2&&(y.text=n[1]?"ERROR \u{1F61E}":"BUY"),k[0]&1&&(y.loading=n[0]),P.$set(y)},i(n){F||($(r.$$.fragment,n),$(P.$$.fragment,n),F=!0)},o(n){x(r.$$.fragment,n),x(P.$$.fragment,n),F=!1},d(n){n&&h(e),ee(r),ne(m,n),I.d(),ee(P),t[24](null),j=!1,V()}}}function De(t,e,r){let a,l,s,p;J(t,ve,i=>r(19,p=i));const{debounce:b,startCase:O,upperFirst:u}=ye,f=[{label:"Norway",value:"NO"},{label:"Sweden",value:"SE"},{label:"Denmark",value:"DK"}];let o=!1,_=!1,c="",R=!1,M,P;const F=async i=>{const{priceId:v}=p[0];try{r(0,o=!0);const B=await Oe(i),ue=await Ee({priceId:v,customerStripeId:B});await Re(ue)}catch(B){r(1,_=!0),console.error(B)}finally{r(0,o=!1)}},j={email:"",name:"",city:"",country:"",line1:"",line2:"",postalCode:"",state:""},{form:V,errors:T,handleChange:m,handleSubmit:Y}=ge({initialValues:j,validationSchema:ke().shape({email:K().email().required(),name:K().required().min(2),city:K().required(),country:K().required().oneOf(f.map(({value:i})=>i)),line1:K().required(),line2:K(),postalCode:K().required(),state:K()}),onSubmit:F});J(t,V,i=>r(8,s=i)),J(t,T,i=>r(7,l=i));const L=b(async()=>{if(!s.country||!s.postalCode)return;const{shippingRate:i,error:v}=await Ce({country:s.country,postalCode:s.postalCode});v&&r(2,c=v),i&&(r(2,c=""),r(4,M=parseFloat(a)+parseFloat(i)))},1e3);let I=()=>{const i=P.querySelectorAll("input");for(let v=0;i.length;v++)if(l[i[v].name])return i[v].scrollIntoView(),i[v].focus()};function n(i){s[i]=he(this),V.set(s),r(11,f)}const k=i=>{r(3,R=!0),m(i),L()};function y(i){s[i]=this.value,V.set(s),r(11,f)}const g=i=>{m(i),L()};function D(i){_e[i?"unshift":"push"](()=>{P=i,r(5,P)})}return t.$$.update=()=>{t.$$.dirty[0]&524288&&r(6,a=p.reduce((i,v)=>i+v.price*v.quantity,0))},[o,_,c,R,M,P,a,l,s,O,u,f,j,V,T,m,Y,L,I,p,n,k,y,g,D]}class Ue extends pe{constructor(e){super(),fe(this,e,De,Le,de,{},null,[-1,-1])}}export{Ue as default};
